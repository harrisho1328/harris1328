<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ç—›é¢¨è¨ˆç®—æ©Ÿ">
<title>ç—›é¢¨è¨ˆç®—æ©Ÿ</title>
<style>
    :root {
        --safe: #34C759;
        --warn: #FFCC00;
        --danger: #FF3B30;
        --bg: #F2F2F7;
        --card: #FFFFFF;
        --blue: #007AFF;
        --text-main: #1C1C1E;
        --text-sub: #8E8E93;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg);
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-tap-highlight-color: transparent;
        color: var(--text-main);
    }
    
    /* é ‚éƒ¨å„€è¡¨æ¿ */
    .dashboard {
        background: white;
        padding: 15px 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        position: sticky;
        top: 0;
        z-index: 50;
    }
    .dashboard-header {
        display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
    }
    .total-display { font-size: 24px; font-weight: 800; color: #333; }
    .limit-label { font-size: 12px; color: var(--text-sub); }
    
    /* é€²åº¦æ¢ */
    .progress-track {
        height: 12px; background: #E5E5EA; border-radius: 6px; overflow: hidden; position: relative;
    }
    .progress-fill {
        height: 100%; width: 0%; transition: width 0.5s, background-color 0.5s, opacity 0.3s;
    }
    .marker-line {
        position: absolute; top:0; bottom:0; width: 2px; background: #fff; z-index: 2;
    }
    
    /* ç‹€æ…‹æ–‡å­—å€ */
    .status-area {
        text-align: center; margin-top: 8px; font-size: 13px; font-weight: bold; min-height: 20px;
    }

    /* é é¢å®¹å™¨ */
    .page-container {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        padding-bottom: 110px; /* é¿é–‹åº•éƒ¨å°èˆª */
        display: none;
    }
    .page-container.active { display: block; }

    /* æœå°‹èˆ‡éæ¿¾ */
    .controls { padding: 0 5px 10px 5px; }
    input[type="text"] {
        width: 100%; padding: 12px; font-size: 16px; border: none; border-radius: 12px; background: #E5E5EA; outline: none; box-sizing: border-box;
    }
    .filter-group { display: flex; gap: 8px; margin-top: 10px; overflow-x: auto; padding-bottom: 5px; }
    .filter-btn {
        padding: 6px 12px; border-radius: 15px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; opacity: 0.6; color: white; white-space: nowrap; flex-shrink: 0;
    }
    .filter-btn.active { opacity: 1; transform: scale(1.05); }

    /* é£Ÿç‰©å¡ç‰‡åˆ—è¡¨ */
    #foodList, #plateList {
        display: grid; grid-template-columns: 1fr; gap: 10px; padding: 0 5px;
    }
    .food-card {
        background: var(--card);
        border-radius: 12px;
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .food-info { display: flex; flex-direction: column; }
    .food-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .food-meta { font-size: 12px; color: var(--text-sub); display: flex; align-items: center; gap: 8px; }
    
    /* ç‡ˆè™Ÿ Badge */
    .badge { padding: 2px 6px; border-radius: 4px; color: white; font-weight: bold; font-size: 10px; }
    .bg-green { background-color: var(--safe); }
    .bg-yellow { background-color: var(--warn); color: black; }
    .bg-red { background-color: var(--danger); }
    
    /* æŒ‰éˆ•æ¨£å¼ */
    .add-btn {
        background: #F2F2F7; color: var(--blue); border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer;
    }
    .add-btn:active { background: #d1d1d6; }
    .remove-btn {
        color: var(--danger); background: none; border: 1px solid var(--danger); padding: 4px 10px; border-radius: 6px; font-size: 12px; cursor: pointer;
    }
    .clear-btn {
        font-size: 13px; color: #888; border: 1px solid #ddd; padding: 4px 10px; border-radius: 6px; background: none; cursor: pointer;
    }

    /* åº•éƒ¨å°èˆª */
    .bottom-nav {
        position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95);
        border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 10px 0;
        backdrop-filter: blur(10px); z-index: 100; padding-bottom: max(10px, env(safe-area-inset-bottom));
    }
    .nav-item { display: flex; flex-direction: column; align-items: center; color: #8E8E93; font-size: 10px; border: none; background: none; cursor: pointer; width: 50%; }
    .nav-item.active { color: var(--blue); }
    .nav-icon { font-size: 24px; margin-bottom: 2px; }

    /* æ‡¸æµ®æ–°å¢æŒ‰éˆ• (FAB) */
    .fab {
        position: fixed; bottom: 100px; right: 20px; background: var(--blue); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; border: none; box-shadow: 0 4px 10px rgba(0,122,255,0.3); z-index: 90; cursor: pointer;
    }

    /* æç¤ºèˆ‡è¦–çª— */
    #toast {
        visibility: hidden; min-width: 200px; background-color: #333; color: #fff; text-align: center; border-radius: 50px; padding: 10px; position: fixed; z-index: 300; left: 50%; bottom: 90px; transform: translateX(-50%); font-size: 14px; opacity: 0; transition: opacity 0.3s;
    }
    #toast.show { visibility: visible; opacity: 0.9; bottom: 100px; }

    .modal-overlay {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 200; align-items: center; justify-content: center;
    }
    .modal-content {
        background: white; padding: 20px; border-radius: 20px; width: 80%; max-width: 300px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
</style>
</head>
<body>

    <div class="dashboard">
        <div class="dashboard-header">
            <div>
                <div class="limit-label">æœ¬é¤æ™®æ— (ç›®æ¨™ <150)</div>
                <div class="total-display"><span id="totalPurine">0</span> <span style="font-size:14px; color:#666;">mg</span></div>
            </div>
            <button class="clear-btn" onclick="clearPlate()">ğŸ—‘ï¸ é‡ç½®</button>
        </div>
        <div class="progress-track">
            <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
            <div class="marker-line" style="left: 37.5%;"></div> </div>
        <div style="display:flex; justify-content:space-between; margin-top:4px; font-size:10px; color:#999;">
            <span>0</span>
            <span style="margin-left:-10px;">150 (å–®é¤)</span>
            <span>400 (å…¨æ—¥)</span>
        </div>
        <div id="statusText" class="status-area" style="color:var(--safe);">âœ… æº–å‚™é–‹å§‹</div>
    </div>

    <div id="searchPage" class="page-container active">
        <div class="controls">
            <input type="text" id="searchInput" placeholder="æœå°‹é£Ÿç‰© (ä¾‹: èŠ¥è˜­, ç‰›æ’)..." onkeyup="filterFood()">
            <div class="filter-btn-group">
                <button class="filter-btn bg-green" onclick="filterByColor('green')">ğŸŸ¢ æ”¾å¿ƒ</button>
                <button class="filter-btn bg-yellow" onclick="filterByColor('yellow')">ğŸŸ¡ é©é‡</button>
                <button class="filter-btn bg-red" onclick="filterByColor('red')">ğŸ”´ å°å¿ƒ</button>
                <button class="filter-btn" style="background:#8E8E93" onclick="filterByColor('all')">å…¨éƒ¨</button>
            </div>
        </div>
        <div id="foodList"></div>
    </div>

    <div id="platePage" class="page-container">
        <h2 style="padding:0 15px; font-size:18px; color:#333;">ğŸ½ï¸ é€™ä¸€é¤åƒäº†...</h2>
        <div id="plateList"></div>
    </div>

    <button class="fab" onclick="openCustomModal()">+</button>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('search')" id="tab-search">
            <div class="nav-icon">ğŸ”</div>
            <div>æ‰¾é£Ÿç‰©</div>
        </button>
        <button class="nav-item" onclick="switchTab('plate')" id="tab-plate">
            <div class="nav-icon">ğŸ“Š</div>
            <div>çœ‹çµæœ</div>
        </button>
    </nav>

    <div id="toast">å·²åŠ å…¥ï¼</div>
    
    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top:0; text-align:center;">æ–°å¢è‡ªè¨‚é£Ÿç‰©</h3>
            <input type="text" id="newFoodName" placeholder="åç¨± (ä¾‹: ä¹¾éºµ)" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box; border:1px solid #ddd; border-radius:8px;">
            <input type="number" id="newFoodPurine" placeholder="æ™®æ—å€¼ (mg/100g)" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box; border:1px solid #ddd; border-radius:8px;">
            <p style="font-size:12px; color:#888; margin:0 0 10px 0;">*å¦‚æœä¸ç¢ºå®šï¼Œè«‹ä¼°ç®—é¡è‰²å³å¯</p>
            <select id="newFoodLevel" style="width:100%; padding:10px; margin-bottom:20px; border-radius:8px;">
                <option value="0">ğŸŸ¢ ç¶ ç‡ˆ (0-50mg)</option>
                <option value="1">ğŸŸ¡ é»ƒç‡ˆ (50-150mg)</option>
                <option value="2">ğŸ”´ ç´…ç‡ˆ (>150mg)</option>
            </select>
            <div style="display:flex; gap:10px;">
                <button onclick="closeCustomModal()" style="flex:1; padding:10px; border:none; background:#E5E5EA; border-radius:8px;">å–æ¶ˆ</button>
                <button onclick="saveNewFood()" style="flex:1; padding:10px; background:var(--blue); color:white; border:none; border-radius:8px;">å„²å­˜</button>
            </div>
        </div>
    </div>

<script>
    // ğŸŒŸ v7.2 å®Œæ•´è³‡æ–™åº« (å«ä¿®æ­£å¾Œçš„åˆ†é¡ + ä»£è¬åœ°é›·é‚è¼¯)
    const defaultDB = [
        // --- ğŸŸ¢ ç¶ ç‡ˆï¼šæ”¾å¿ƒåƒ (Low Purine) 0 ~ 50 mg ---
        {name: "èœå¿ƒ/èŠ¥è˜­", purine: 25, level: 0},
        {name: "é’ç“œ", purine: 10, level: 0},
        {name: "èŒ„å­", purine: 20, level: 0},
        {name: "ç²Ÿç±³ (Corn)", purine: 30, level: 0},
        {name: "å—ç“œ", purine: 25, level: 0},
        {name: "ç”˜ç­/ç´…è˜¿è””", purine: 15, level: 0},
        {name: "é›²è€³/æœ¨è€³", purine: 10, level: 0},
        {name: "é‡‘é‡è‡", purine: 50, level: 0},
        {name: "ç•ªèŒ„è›‹é£¯", purine: 50, level: 0},
        {name: "ç±³ç²‰/ç²‰çµ²", purine: 15, level: 0},
        {name: "é€šç²‰/æ„ç²‰", purine: 20, level: 0},
        {name: "æ–¹åŒ…/é¥…é ­", purine: 20, level: 0},
        {name: "è˜‹æœ", purine: 14, level: 0},
        {name: "é¦™è•‰", purine: 16, level: 0},
        {name: "ç«é¾æœ", purine: 20, level: 0},
        {name: "è¥¿ç“œ", purine: 10, level: 0},
        {name: "è—è“/å£«å¤šå•¤æ¢¨", purine: 18, level: 0},
        {name: "å¸ƒç”¸/å•«å–±", purine: 8, level: 0},
        {name: "æµ·åƒ", purine: 8, level: 0},
        {name: "ä¸‰æ–‡é­šç±½", purine: 20, level: 0},
        {name: "èŒ¶ç¢—è’¸", purine: 20, level: 0},
        {name: "è¥¿è˜­èŠ±", purine: 70, level: 0},
        {name: "è èœ", purine: 57, level: 0},
        {name: "è±†è…", purine: 20, level: 0},
        {name: "ç™½é£¯/éºµ", purine: 25, level: 0},
        {name: "é›è›‹", purine: 0, level: 0},
        {name: "ç‰›å¥¶", purine: 0, level: 0},

        // --- ğŸŸ¡ é»ƒç‡ˆï¼šé©é‡åƒ (Medium Purine) 50 ~ 150 mg --- 
        {name: "è¥¿å†·/è‚‰çœ¼ç‰›æ’", purine: 110, level: 1},
        {name: "ç‰›è…©", purine: 130, level: 1},
        {name: "å‰åˆ—ç‰›/è±¬ (ç‚¸)", purine: 120, level: 1},
        {name: "é›è…¿è‚‰", purine: 140, level: 1},
        {name: "ç˜¦è±¬è‚‰", purine: 119, level: 1},
        {name: "é›èƒ¸è‚‰", purine: 137, level: 1},
        {name: "Parma Ham", purine: 150, level: 1},
        {name: "é­šå­é†¬", purine: 144, level: 1},
        {name: "å°ç± åŒ…", purine: 100, level: 1},
        {name: "é³³çˆª", purine: 130, level: 1},
        {name: "è²¢ä¸¸/ç‰›ä¸¸", purine: 80, level: 1},
        {name: "ä¸‰æ–‡é­š", purine: 119, level: 1},
        {name: "é±ˆé­š", purine: 109, level: 1},
        {name: "è˜†ç­", purine: 55, level: 1},
        {name: "é®®å†¬è‡", purine: 60, level: 1},
        {name: "çš®è›‹ç˜¦è‚‰ç²¥", purine: 70, level: 1},
        {name: "ç²Ÿç±³è‚‰ç²’é£¯", purine: 80, level: 1},
        {name: "æä»/æ ¸æ¡ƒ", purine: 35, level: 1},
        {name: "èŠ±ç”Ÿ", purine: 79, level: 1},

        // --- ğŸ”´ ç´…ç‡ˆï¼šå°å¿ƒ / é¿å… (High Purine) > 150 mg ---
        {name: "é›ç²¾/æ»´é›ç²¾", purine: 500, level: 2}, 
        {name: "å°é­šä¹¾", purine: 1138, level: 2},     
        {name: "é…µæ¯ç²‰", purine: 680, level: 2},
        {name: "è±¬è‚", purine: 284, level: 2},
        {name: "å¤§é–˜èŸ¹è†", purine: 300, level: 2},    
        {name: "è€ç«æ¹¯", purine: 150, level: 2},      
        {name: "ç‡’éµ/é´¨", purine: 165, level: 2},
        {name: "è±¬æ½¤éºµ", purine: 280, level: 2},
        {name: "æ²™ç”¸é­š", purine: 210, level: 2},
        {name: "é¯–é­š", purine: 165, level: 2},
        {name: "è ”/é’å£", purine: 180, level: 2},
        {name: "ä¹¾é»ƒè±†", purine: 172, level: 2},
        {name: "å†¬è”­åŠŸæ¹¯", purine: 180, level: 2},    
        {name: "è±šéª¨æ‹‰éºµæ¹¯", purine: 160, level: 2},

        // --- ğŸš¨ ç‰¹æ®Šä»£è¬åœ°é›· (ä½æ•¸å€¼ä½†å¼·åˆ¶ç´…ç‡ˆ) ---
        // å•¤é…’ï¼šé›™é‡æ‰“æ“Š
        {name: "å•¤é…’ (350ml)", purine: 20, level: 2, isTrigger: true}, 
        
        // çƒˆé…’ï¼šå¼·çƒˆé˜»ç¤™ä»£è¬
        {name: "å¨å£«å¿Œ/ä¼ç‰¹åŠ ", purine: 0, level: 2, isTrigger: true},
        
        // ç‡’é…’é¡
        {name: "æ—¥æœ¬ç‡’é… (ç„¡ç³–)", purine: 0, level: 2, isTrigger: true},
        {name: "éŸ“åœ‹ç‡’é…’ (å«ç³–)", purine: 0, level: 2, isTrigger: true}, // é…’ç²¾+æœç³–
        
        // å«ç³–é£²å“
        {name: "çç å¥¶èŒ¶", purine: 10, level: 2, isTrigger: true},     
        {name: "å«ç³–æ±½æ°´/å¯æ¨‚", purine: 10, level: 2, isTrigger: true},
    ];

    let allFoods = [];
    let currentFilter = 'all';

    // åˆå§‹åŒ–
    function init() {
        allFoods = [...defaultDB];
        // æ’åºï¼šç¶ ç‡ˆå„ªå…ˆ (è®“å¿ƒæƒ…å¥½ä¸€é»)
        allFoods.sort((a, b) => a.level - b.level);
        
        // è¼‰å…¥è‡ªè¨‚é£Ÿç‰©
        const customData = localStorage.getItem('myGoutFoods_v7');
        if (customData) {
            const customFoods = JSON.parse(customData);
            customFoods.forEach(f => f.isCustom = true);
            allFoods = [...customFoods, ...allFoods];
        }
        filterFood();
        renderPlate();
    }

    // é é¢åˆ‡æ›
    function switchTab(tab) {
        document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(tab + 'Page').classList.add('active');
        document.getElementById('tab-' + tab).classList.add('active');
    }

    // æ¸²æŸ“æœå°‹åˆ—è¡¨
    function renderList(items) {
        const listContainer = document.getElementById('foodList');
        listContainer.innerHTML = '';
        if (items.length === 0) {
            listContainer.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">æ‰¾ä¸åˆ°...</div>';
            return;
        }
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'food-card';
            let badgeClass = '', badgeText = '';
            if(item.level == 0) { badgeClass = 'bg-green'; badgeText = 'ç¶ '; }
            else if(item.level == 1) { badgeClass = 'bg-yellow'; badgeText = 'é»ƒ'; }
            else { badgeClass = 'bg-red'; badgeText = 'ç´…'; }

            // å¦‚æœæ˜¯åœ°é›·ï¼Œåœ¨åˆ—è¡¨ä¸­ä¹Ÿæ¨™ç¤º
            const triggerText = item.isTrigger ? 'âš ï¸ ' : '';
            const itemString = encodeURIComponent(JSON.stringify(item));
            
            div.innerHTML = `
                <div class="food-info">
                    <span class="food-name">${triggerText}${item.name} ${item.isCustom ? 'âœï¸':''}</span>
                    <div class="food-meta">
                        <span class="badge ${badgeClass}">${badgeText}</span>
                        <span>ç´„ ${item.purine} mg/100g</span>
                    </div>
                </div>
                <button class="add-btn" onclick="addToPlate('${itemString}')">åŠ å…¥</button>
            `;
            listContainer.appendChild(div);
        });
    }

    // æ¸²æŸ“é¤ç›¤åˆ—è¡¨ (å¸¶æœ‰ç§»é™¤æŒ‰éˆ•)
    function renderPlateList(items) {
        const listContainer = document.getElementById('plateList');
        listContainer.innerHTML = '';
        if (items.length === 0) {
            listContainer.innerHTML = '<div style="text-align:center;color:#999;padding:30px;">ç›¤å­ç©ºç©ºçš„...<br>å»åŠ é»å¥½åƒçš„å§ï¼</div>';
            return;
        }
        items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'food-card';
            const realIndex = items.length - 1 - index; // å€’åº
            
            // è­¦ç¤ºæ–‡å­—
            const triggerWarning = item.isTrigger ? '<br><span style="color:var(--danger); font-size:11px;">âš ï¸ ä»£è¬é˜»ç¤™ (é…’ç²¾/ç³–)</span>' : '';

            div.innerHTML = `
                <div class="food-info">
                    <span class="food-name">${item.name} ${triggerWarning}</span>
                    <div class="food-meta">
                        <span>+ ${item.purine} mg</span>
                    </div>
                </div>
                <button class="remove-btn" onclick="removeFromPlate(${realIndex})">ç§»é™¤</button>
            `;
            listContainer.appendChild(div);
        });
    }

    // æœå°‹åŠŸèƒ½
    function filterFood() {
        const searchText = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allFoods.filter(item => {
            const matchesSearch = item.name.toLowerCase().includes(searchText);
            const matchesColor = currentFilter === 'all' ? true :
                currentFilter === 'green' ? item.level == 0 :
                currentFilter === 'yellow' ? item.level == 1 : item.level == 2;
            return matchesSearch && matchesColor;
        });
        renderList(filtered);
    }

    function filterByColor(color) {
        currentFilter = color;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        filterFood();
    }

    // --- æ ¸å¿ƒè¨ˆç®—é‚è¼¯ (å«åœ°é›·åˆ¤å®š) ---
    function addToPlate(itemString) {
        const item = JSON.parse(decodeURIComponent(itemString));
        let plate = JSON.parse(localStorage.getItem('goutPlate_v7') || "[]");
        plate.push(item);
        localStorage.setItem('goutPlate_v7', JSON.stringify(plate));
        renderPlate();
        showToast(`å·²åŠ å…¥ ${item.name}`);
    }

    function removeFromPlate(index) {
        let plate = JSON.parse(localStorage.getItem('goutPlate_v7') || "[]");
        plate.splice(index, 1);
        localStorage.setItem('goutPlate_v7', JSON.stringify(plate));
        renderPlate();
    }

    function clearPlate() {
        if(confirm("ç¢ºå®šè¦é‡ç½®è¨ˆç®—å—ï¼Ÿ")) {
            localStorage.setItem('goutPlate_v7', "[]");
            renderPlate();
        }
    }

    function renderPlate() {
        const plate = JSON.parse(localStorage.getItem('goutPlate_v7') || "[]");
        renderPlateList(plate.slice().reverse()); // é¡¯ç¤ºåˆ—è¡¨
        
        let total = 0;
        // ğŸŒŸ é—œéµé‚è¼¯ï¼šæª¢æŸ¥æ˜¯å¦æœ‰åœ°é›·
        const hasTrigger = plate.some(item => item.isTrigger === true);

        plate.forEach(i => total += (i.purine || 0));
        
        // æ›´æ–° UI
        const totalDisplay = document.getElementById('totalPurine');
        const progressFill = document.getElementById('progressFill');
        const statusText = document.getElementById('statusText');
        
        animateValue(totalDisplay, parseInt(totalDisplay.innerText), total, 500);

        let percentage = (total / 400) * 100;
        if(percentage > 100) percentage = 100;
        
        // è¨­å®šé€²åº¦æ¢å¯¬åº¦
        progressFill.style.width = percentage + "%";
        
        // é¡è‰²èˆ‡ç‹€æ…‹åˆ¤å®š
        if (hasTrigger) {
            // ğŸš¨ è§¸ç™¼åœ°é›·ï¼šå¼·åˆ¶ç´…ç‡ˆ
            progressFill.style.backgroundColor = "var(--danger)";
            progressFill.style.opacity = "0.8"; // ç¨å¾®è®Šæš—ä»¥ç¤ºä¸åŒ
            statusText.innerHTML = "ğŸš¨ <b>ä»£è¬å—é˜»è­¦å ±ï¼</b><br>å«é…’ç²¾/é«˜ç³–ï¼Œé˜»ç¤™å°¿é…¸æ’å‡º";
            statusText.style.color = "var(--danger)";
        } else {
            // æ­£å¸¸æ™®æ—è¨ˆç®—
            progressFill.style.opacity = "1";
            if (total < 150) {
                progressFill.style.backgroundColor = "var(--safe)";
                statusText.innerText = "âœ… é€™ä¸€é¤å¾ˆå®‰å…¨ (å–®é¤å»ºè­° <150)";
                statusText.style.color = "var(--safe)";
            } else if (total < 300) {
                progressFill.style.backgroundColor = "var(--warn)";
                statusText.innerText = "âš ï¸ ç•™æ„ä»½é‡ (å…¨æ—¥å»ºè­° <400)";
                statusText.style.color = "#FFCC00";
            } else {
                progressFill.style.backgroundColor = "var(--danger)";
                statusText.innerText = "ğŸš¨ å±éšªï¼æ¥è¿‘å–®æ—¥ä¸Šé™";
                statusText.style.color = "var(--danger)";
            }
        }
    }

    // æ•¸å­—è·³å‹•å‹•ç•«
    function animateValue(obj, start, end, duration) {
        if (start === end) return;
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            obj.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    // --- è‡ªè¨‚é£Ÿç‰© ---
    function openCustomModal() { document.getElementById('customModal').style.display = 'flex'; }
    function closeCustomModal() { document.getElementById('customModal').style.display = 'none'; }
    
    function saveNewFood() {
        const name = document.getElementById('newFoodName').value;
        const purine = parseInt(document.getElementById('newFoodPurine').value) || 0;
        const level = parseInt(document.getElementById('newFoodLevel').value);
        
        if(!name) { alert("è«‹è¼¸å…¥åç¨±"); return; }
        
        const newFood = { name, purine, level, isCustom:true };
        let customFoods = JSON.parse(localStorage.getItem('myGoutFoods_v7') || "[]");
        customFoods.unshift(newFood);
        localStorage.setItem('myGoutFoods_v7', JSON.stringify(customFoods));
        closeCustomModal();
        init();
    }
    
    function showToast(msg) {
        const t = document.getElementById("toast");
        t.innerText = msg; t.className = "show";
        setTimeout(() => t.className = "", 2000);
    }

    // é»æ“Šé®ç½©é—œé–‰
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            closeCustomModal();
        }
    }

    init();
</script>
</body>
</html>
